<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flash Viewer (Ruffle)</title>
  <meta name="description" content="Alternate host for selected educational Flash (SWF) animations, played via Ruffle." />

  <style>
    :root { color-scheme: light dark; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.35; }
    header, footer { padding: 14px 16px; }
    header { border-bottom: 1px solid rgba(127,127,127,.35); }
    main { padding: 16px; display: grid; gap: 12px; }
    .wrap { max-width: 1100px; margin: 0 auto; width: 100%; }

    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    label { font-weight: 600; }
    select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(127,127,127,.45);
      background: rgba(127,127,127,.10);
      min-width: min(520px, 92vw);
    }
    button {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(127,127,127,.45);
      background: rgba(127,127,127,.12);
      cursor: pointer;
    }
    button:hover { background: rgba(127,127,127,.18); }
    .note { opacity: .85; font-size: .95rem; }
    a { color: inherit; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: .95em; }

    /* Player box uses aspect ratio set by JS */
    .playerShell {
      width: 100%;
      max-width: 980px;
      aspect-ratio: var(--ar, 612 / 357);
      background: #666;
      border: 1px solid rgba(127,127,127,.45);
      border-radius: 10px;
      overflow: hidden;
    }
  </style>

  <!-- Ruffle configuration (must be set before loading ruffle.js) -->
  <script>
    window.RufflePlayer = window.RufflePlayer || {};
    window.RufflePlayer.config = {
      autoplay: "on",
      unmuteOverlay: "visible",
      warnOnUnsupportedContent: true,
      upgradeToHttps: true
    };
  </script>
</head>

<body>
  <header class="wrap">
    <strong id="pageTitle">Flash Viewer</strong>
    <div class="note">SWF playback via Ruffle</div>
  </header>

  <main class="wrap">
    <div class="row" aria-label="Animation selector">
      <label for="swfSelect">Animation</label>
      <select id="swfSelect"></select>
    </div>

    <div class="row" aria-label="Player controls">
      <button id="btnRestart" type="button">Restart</button>
      <button id="btnFullscreen" type="button">Fullscreen</button>
      <a id="downloadLink" class="note" href="#" download>Download SWF</a>
    </div>

    <div id="playerShell" class="playerShell" role="region" aria-label="Interactive player region">
      <div id="playerHost" style="width:100%;height:100%"></div>
    </div>

    <div id="supportNote" class="note">
      If the animation does not run correctly, it may use Flash features not yet supported by Ruffle.
    </div>
  </main>

  <footer class="wrap">
    <hr style="border:none;border-top:1px solid rgba(127,127,127,.35);margin:14px 0" />
    <div id="attribution" class="note"></div>
    <div class="note" style="margin-top:8px">
      Hosting note: confirm redistribution/hosting rights before making a public copy.
    </div>
  </footer>

  <!-- Ruffle loader -->
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>

  <script>
    // Add/adjust entries here
    const ANIMATIONS = [
      {
        id: "w2u-seafloor",
        label: "Windows to the Universe — Seafloor Spreading & Magnetic Field Reversals",
        file: "assets/seafloor_spreading_interactive.swf",
        aspect: "612 / 357",
        pageTitle: "Seafloor Spreading (Windows to the Universe)",
        attributionHtml: `
          <strong>Attribution / citation:</strong>
          “Interactive Animation of Seafloor Spreading and Magnetic Field Reversals,”
          <em>Windows to the Universe</em>.
          Original page:
          <a href="https://www.windows2universe.org/earth/interior/seafloor_spreading_interactive.html" target="_blank" rel="noopener noreferrer">
            windows2universe.org/earth/interior/seafloor_spreading_interactive.html
          </a>.
          Accessed 2026-02-08.
          <br />
          Windows to the Universe is presented by the National Earth Science Teachers Association (NESTA).
        `
      },
      {
        id: "ucsd-magnetization",
        label: "Earthguide (UCSD/Scripps) — Magnetization of the Sea Floor & Seafloor Spreading",
        file: "assets/magnetization.swf",
        aspect: "4 / 3",   // adjust if you want a different default box shape
        pageTitle: "Magnetization of the Sea Floor (Earthguide)",
        attributionHtml: `
          <strong>Attribution / citation:</strong>
          “Magnetization of the Sea Floor and Seafloor Spreading,”
          <em>Earthguide: Online Classroom</em> (Scripps Institution of Oceanography, UC San Diego).
          Original page:
          <a href="https://earthguide.ucsd.edu/eoc/teachers/t_tectonics/p_paleomag.html" target="_blank" rel="noopener noreferrer">
            earthguide.ucsd.edu/eoc/teachers/t_tectonics/p_paleomag.html
          </a>.
          Accessed 2026-02-08.
        `
      }
    ];

    const sel = document.getElementById("swfSelect");
    const pageTitleEl = document.getElementById("pageTitle");
    const attributionEl = document.getElementById("attribution");
    const downloadLink = document.getElementById("downloadLink");
    const host = document.getElementById("playerHost");
    const shell = document.getElementById("playerShell");

    function setQueryParam(key, value) {
      const url = new URL(location.href);
      url.searchParams.set(key, value);
      history.replaceState(null, "", url.toString());
    }

    function getSelectedIdFromUrlOrStorage() {
      const urlId = new URLSearchParams(location.search).get("a");
      if (urlId && ANIMATIONS.some(x => x.id === urlId)) return urlId;
      const saved = localStorage.getItem("selectedAnimationId");
      if (saved && ANIMATIONS.some(x => x.id === saved)) return saved;
      return ANIMATIONS[0].id;
    }

    function createAndLoadPlayer(swfUrl) {
      host.innerHTML = "";

      const ruffle = window.RufflePlayer?.newest?.();
      if (!ruffle) {
        host.innerHTML =
          '<div style="padding:12px;color:#fff;background:#333;height:100%">' +
          'Ruffle failed to load. Check your network/CDN access.' +
          '</div>';
        return null;
      }

      const player = ruffle.createPlayer();
      player.style.width = "100%";
      player.style.height = "100%";
      host.appendChild(player);

      player.load({ url: swfUrl });
      return player;
    }

    let player = null;

    function applySelection(id, writeState = true) {
      const item = ANIMATIONS.find(x => x.id === id) || ANIMATIONS[0];

      if (writeState) {
        localStorage.setItem("selectedAnimationId", item.id);
        setQueryParam("a", item.id);
      }

      document.title = item.pageTitle;
      pageTitleEl.textContent = item.pageTitle;

      shell.style.setProperty("--ar", item.aspect);

      attributionEl.innerHTML = item.attributionHtml;

      downloadLink.href = item.file;
      downloadLink.textContent = `Download SWF (${item.file.split("/").pop()})`;

      player = createAndLoadPlayer(item.file);
    }

    // Build dropdown
    for (const item of ANIMATIONS) {
      const opt = document.createElement("option");
      opt.value = item.id;
      opt.textContent = item.label;
      sel.appendChild(opt);
    }

    // Initial selection
    const initialId = getSelectedIdFromUrlOrStorage();
    sel.value = initialId;
    applySelection(initialId, false);

    sel.addEventListener("change", () => applySelection(sel.value, true));

    document.getElementById("btnRestart").addEventListener("click", () => {
      applySelection(sel.value, true);
    });

    document.getElementById("btnFullscreen").addEventListener("click", async () => {
      try {
        if (!document.fullscreenElement) await shell.requestFullscreen();
        else await document.exitFullscreen();
      } catch (_) {}
    });
  </script>
</body>
</html>
